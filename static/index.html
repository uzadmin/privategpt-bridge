<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrivateGPT Bridge</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .status-online {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-offline {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
        }

        .mode-btn:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .mode-btn.active {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
        }

        .mode-description {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 4px;
            display: block;
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area.dragover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.02);
        }

        .upload-icon {
            font-size: 2.5rem;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        .upload-text {
            color: #64748b;
            font-size: 1rem;
            margin-bottom: 6px;
        }

        .upload-subtext {
            color: #94a3b8;
            font-size: 0.8rem;
        }

        .file-input {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 12px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: width 0.3s ease;
        }

        .files-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s ease;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background: #f3f4f6;
        }

        .file-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-checkbox {
            margin-right: 8px;
        }

        .file-name {
            font-size: 0.9rem;
            color: #374151;
            font-weight: 500;
        }

        .file-meta {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .btn-delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .btn-delete:hover {
            background: #fecaca;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .settings-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .settings-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .chat-container {
            height: 500px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 16px 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-mode-indicator {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 500;
        }

        .clear-history-btn {
            padding: 6px 12px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .clear-history-btn:hover {
            background: #e5e7eb;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-content {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-wrap: break-word;
            transition: all 0.2s ease;
        }

        .message-content.streaming {
            position: relative;
        }

        .message-content.streaming::after {
            content: '‚ñä';
            color: #3b82f6;
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .message-content p {
            margin: 0 0 8px 0;
        }

        .message-content p:last-child {
            margin-bottom: 0;
        }

        .message-content h2, .message-content h3, .message-content h4 {
            margin: 12px 0 6px 0;
            line-height: 1.3;
        }

        .message-content code {
            background: rgba(0, 0, 0, 0.1) !important;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }

        .message-content strong {
            font-weight: 600;
        }

        .message-content em {
            font-style: italic;
        }

        .message-content div[style*="margin"] {
            line-height: 1.4;
        }

        .message.user .message-content {
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 4px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #dbeafe;
            color: #3b82f6;
        }

        .message.assistant .message-avatar {
            background: #f3f4f6;
            color: #6b7280;
        }

        .message-sources {
            margin-top: 8px;
            padding: 8px 12px;
            background: #f0f9ff;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #0c4a6e;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .system-prompt-container {
            margin-bottom: 16px;
        }

        .system-prompt {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 60px;
            background: #f9fafb;
        }

        .system-prompt:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            font-size: 0.95rem;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-button {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: background 0.2s ease;
            min-width: 80px;
        }

        .send-button:hover:not(:disabled) {
            background: #2563eb;
        }

        .send-button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6b7280;
            font-style: italic;
            margin: 16px 0;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .empty-state {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 20px;
        }

        .selected-files-info {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #1e40af;
        }

        .delete-all-confirmation {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            font-size: 0.9rem;
            color: #991b1b;
        }

        .delete-all-confirmation strong {
            color: #7f1d1d;
        }

        .processing-files {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.85rem;
        }

        .processing-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f59e0b;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 6px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>üîí PrivateGPT Bridge</h1>
                <p>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏</p>
                <div :class="['status-indicator', status.online ? 'status-online' : 'status-offline']">
                    <div class="status-dot"></div>
                    {{ status.message }}
                </div>
            </div>

            <div class="main-content">
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="sidebar">
                    <!-- –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ -->
                    <div class="card">
                        <h2>üéØ –†–µ–∂–∏–º –ò–ò</h2>
                        <div class="mode-selector">
                            <div 
                                :class="['mode-btn', { active: config.mode === 'rag' }]"
                                @click="setMode('rag')"
                            >
                                <div>RAG</div>
                                <span class="mode-description">–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</span>
                            </div>
                            <div 
                                :class="['mode-btn', { active: config.mode === 'search' }]"
                                @click="setMode('search')"
                            >
                                <div>–ü–æ–∏—Å–∫</div>
                                <span class="mode-description">–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö</span>
                            </div>
                            <div 
                                :class="['mode-btn', { active: config.mode === 'basic' }]"
                                @click="setMode('basic')"
                            >
                                <div>–ë–∞–∑–æ–≤—ã–π</div>
                                <span class="mode-description">–û–±—ã—á–Ω—ã–π —á–∞—Ç</span>
                            </div>
                            <div 
                                :class="['mode-btn', { active: config.mode === 'summarize' }]"
                                @click="setMode('summarize')"
                            >
                                <div>–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è</div>
                                <span class="mode-description">–†–µ–∑—é–º–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</span>
                            </div>
                        </div>
                    </div>

                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
                    <div class="card">
                        <h2>üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã</h2>
                        <div 
                            class="upload-area"
                            :class="{ dragover: isDragOver }"
                            @click="triggerFileInput"
                            @dragover.prevent="isDragOver = true"
                            @dragleave.prevent="isDragOver = false"
                            @drop.prevent="handleFileDrop"
                        >
                            <div class="upload-icon">üìÅ</div>
                            <div class="upload-text">
                                {{ uploading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã' }}
                            </div>
                            <div class="upload-subtext">
                                PDF, DOCX, TXT, MD, CSV...
                            </div>
                        </div>

                        <input 
                            type="file" 
                            ref="fileInput" 
                            class="file-input"
                            @change="handleFileSelect"
                            accept=".pdf,.docx,.doc,.txt,.md,.html,.csv,.json,.pptx,.ppt,.epub,.ipynb"
                            multiple
                        >

                        <div v-if="uploading" class="progress-bar">
                            <div class="progress-fill" :style="{ width: uploadProgress + '%' }"></div>
                        </div>

                        <div v-if="debugMode && lastUploadError" 
                             style="background: #fef2f2; border: 1px solid #f87171; border-radius: 8px; padding: 12px; margin: 12px 0; font-size: 0.85rem;">
                            <strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</strong><br>
                            <pre style="white-space: pre-wrap; font-family: monospace; margin-top: 8px;">{{ lastUploadError }}</pre>
                        </div>

                        <div v-if="deletingAllFiles" class="delete-all-confirmation">
                            <strong>‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</strong><br>
                            –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä.
                        </div>

                        <div v-if="processingFiles.size > 0" class="processing-files">
                            <strong><span class="processing-indicator"></span>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:</strong><br>
                            <div v-for="filename in Array.from(processingFiles)" :key="filename" style="margin-top: 4px;">
                                üìÑ {{ filename }} <span style="color: #92400e;">(–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...)</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 0.8rem; color: #92400e;">
                                –§–∞–π–ª—ã –ø–æ—è–≤—è—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
                            </div>
                        </div>

                        <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
                        <div v-if="files.length > 0">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-size: 0.9rem; color: #6b7280;">
                                    {{ files.length }} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                                    <span v-if="processingFiles.size > 0" style="color: #f59e0b;">
                                        + {{ processingFiles.size }} –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
                                    </span>
                                </span>
                                <div style="display: flex; gap: 8px;">
                                    <button 
                                        class="btn-small"
                                        style="background: #e0f2fe; color: #0369a1;"
                                        @click="selectAllFiles"
                                        :disabled="config.selectedDocs.length === files.length"
                                    >
                                        –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
                                    </button>
                                    <button 
                                        class="btn-small"
                                        style="background: #f3f4f6; color: #374151;"
                                        @click="clearSelectedFiles"
                                        :disabled="config.selectedDocs.length === 0"
                                    >
                                        –û—á–∏—Å—Ç–∏—Ç—å
                                    </button>
                                    <button 
                                        class="btn-small"
                                        style="background: #fef2f2; color: #dc2626;"
                                        @click="deleteAllFiles"
                                        :disabled="deletingAllFiles || files.length === 0"
                                        title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã"
                                    >
                                        {{ deletingAllFiles ? '–£–¥–∞–ª–µ–Ω–∏–µ...' : 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ' }}
                                    </button>
                                </div>
                            </div>
                            
                            <div v-if="deletingAllFiles" class="progress-bar" style="margin-bottom: 12px;">
                                <div class="progress-fill" style="width: 100%; animation: pulse 2s infinite;"></div>
                            </div>
                            
                            <div class="files-list">
                                <div v-for="file in files" :key="file.doc_id" class="file-item">
                                    <div class="file-info">
                                        <input 
                                            type="checkbox" 
                                            class="file-checkbox"
                                            :value="file.doc_id"
                                            v-model="config.selectedDocs"
                                            :disabled="deletingAllFiles"
                                        >
                                        <div>
                                            <div class="file-name">{{ getFileName(file) }}</div>
                                            <div class="file-meta">
                                                {{ getFileType(file) }} ‚Ä¢ ID: {{ file.doc_id.substring(0, 8) }}...
                                            </div>
                                        </div>
                                    </div>
                                    <div class="file-actions">
                                        <button 
                                            class="btn-small btn-delete"
                                            @click="deleteFile(file.doc_id)"
                                            :disabled="deletingFile === file.doc_id || deletingAllFiles"
                                            title="–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç"
                                        >
                                            {{ deletingFile === file.doc_id ? '...' : 'üóëÔ∏è' }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                        </div>
                    </div>

                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                    <div class="card">
                        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                        <div class="settings-group">
                            <label class="settings-label">–ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤</label>
                            <input 
                                type="number" 
                                v-model.number="config.maxTokens"
                                @input="updateMaxTokens"
                                class="settings-input"
                                min="1"
                                max="4000"
                            >
                        </div>
                        <div class="settings-group">
                            <label class="settings-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
                            <input 
                                type="range" 
                                v-model.number="config.temperature"
                                @input="updateTemperature"
                                class="settings-input"
                                min="0"
                                max="1"
                                step="0.1"
                            >
                            <div style="text-align: center; font-size: 0.8rem; color: #6b7280; margin-top: 4px;">
                                {{ config.temperature }}
                            </div>
                        </div>
                        <div class="settings-group">
                            <label class="settings-label">
                                <input type="checkbox" v-model="config.useContext" @change="updateUseContext" style="margin-right: 8px;">
                                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
                            </label>
                        </div>
                        
                        <div class="settings-group">
                            <label class="settings-label">
                                <input type="checkbox" v-model="debugMode" style="margin-right: 8px;">
                                –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ API)
                            </label>
                        </div>

                        <div v-if="debugMode" class="settings-group">
                            <button 
                                class="btn-small"
                                style="background: #f0f9ff; color: #0369a1; width: 100%; margin-bottom: 5px;"
                                @click="testConnection"
                            >
                                üîß –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                            </button>
                        </div>

                        <div v-if="debugMode" class="settings-group">
                            <button 
                                class="btn-small"
                                style="background: #f0fdf4; color: #15803d; width: 100%; margin-bottom: 5px;"
                                @click="debugSettings"
                            >
                                üîç –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>

                        <div v-if="debugMode" class="settings-group">
                            <button 
                                class="btn-small"
                                style="background: #fef3cd; color: #92400e; width: 100%;"
                                @click="testChatAPI"
                            >
                                üß™ –¢–µ—Å—Ç Chat API
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
                <div class="card">
                    <h2>üí¨ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞</h2>
                    
                    <div v-if="config.selectedDocs.length > 0" class="selected-files-info">
                        üìã –†–∞–±–æ—Ç–∞—é —Å {{ config.selectedDocs.length }} –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
                    </div>

                    <div v-if="config.mode !== 'basic' && config.selectedDocs.length === 0 && files.length > 0" 
                         style="background: #fef3cd; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 0.9rem; color: #92400e;">
                        ‚ö†Ô∏è –†–µ–∂–∏–º {{ config.mode.toUpperCase() }} —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
                    </div>

                    <div v-if="config.mode !== 'basic' && files.length === 0" 
                         style="background: #fef2f2; border: 1px solid #f87171; border-radius: 8px; padding: 12px; margin-bottom: 16px; font-size: 0.9rem; color: #dc2626;">
                        üìÑ –†–µ–∂–∏–º {{ config.mode.toUpperCase() }} —Ç—Ä–µ–±—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã —Å–Ω–∞—á–∞–ª–∞.
                    </div>

                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="chat-mode-indicator">
                                –†–µ–∂–∏–º: <strong>{{ config.mode.toUpperCase() }}</strong>
                                <span v-if="config.mode !== 'basic'">
                                    {{ config.useContext ? '+ –ö–æ–Ω—Ç–µ–∫—Å—Ç' : '- –ö–æ–Ω—Ç–µ–∫—Å—Ç' }}
                                    <span v-if="config.selectedDocs.length > 0">
                                        ({{ config.selectedDocs.length }} –¥–æ–∫.)
                                    </span>
                                </span>
                                <span v-if="config.mode === 'basic'" style="color: #6b7280;">
                                    (–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
                                </span>
                            </div>
                            <button 
                                class="clear-history-btn"
                                @click="clearHistory"
                                :disabled="messages.length === 0"
                            >
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                            </button>
                        </div>

                        <div class="chat-messages" ref="chatMessages">
                            <div v-for="message in messages" :key="message.id" :class="['message', message.role]">
                                <div class="message-avatar">
                                    {{ message.role === 'user' ? '–ü' : '–ò–ò' }}
                                </div>
                                <div>
                                    <div 
                                        :class="['message-content', { streaming: message.streaming }]" 
                                        v-html="formatContent(message.content)"
                                    >
                                    </div>
                                    <div v-if="message.sources && message.sources.length > 0" class="message-sources">
                                        üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏: {{ message.sources.join(', ') }}
                                    </div>
                                </div>
                            </div>
                            
                            <div v-if="isTyping && !hasStreamingMessage" class="typing-indicator">
                                <div class="message-avatar">–ò–ò</div>
                                <div>
                                    –ò–ò –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
                                    <div class="typing-dots">
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="chat-input-area">
                            <div class="system-prompt-container">
                                <textarea 
                                    v-model="systemPrompt"
                                    class="system-prompt"
                                    placeholder="–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ò–ò..."
                                ></textarea>
                            </div>

                            <div class="chat-input-container">
                                <textarea 
                                    v-model="currentMessage"
                                    class="chat-input"
                                    placeholder="–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –æ –≤–∞—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –∏–ª–∏ –æ–±—â–∞–π—Ç–µ—Å—å..."
                                    @keydown.enter.exact="sendMessage"
                                    @keydown.enter.shift.prevent="currentMessage += '\n'"
                                    :disabled="isTyping"
                                ></textarea>
                                <button 
                                    class="send-button"
                                    @click="sendMessage"
                                    :disabled="!currentMessage.trim() || isTyping"
                                >
                                    {{ isTyping ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
        <div v-if="notification.show" :class="['notification', notification.type, { show: notification.show }]">
            {{ notification.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    status: { online: false, message: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...' },
                    uploading: false,
                    uploadProgress: 0,
                    isDragOver: false,
                    files: [],
                    deletingFile: null,
                    deletingAllFiles: false,
                    processingFiles: new Set(),
                    messages: [],
                    currentMessage: '',
                    isTyping: false,
                    systemPrompt: '',
                    notification: { show: false, message: '', type: 'success' },
                    messageId: 0,
                    config: {
                        mode: 'rag',
                        useContext: true,
                        use_context: true, // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å API
                        selectedDocs: [],
                        maxTokens: 2000,
                        temperature: 0.7
                    },
                    debugMode: false,
                    lastUploadError: null
                };
            },
            
            computed: {
                hasStreamingMessage() {
                    return this.messages.some(message => message.streaming);
                }
            },
            
            mounted() {
                this.checkStatus();
                this.loadFiles();
                this.autoResizeTextarea();
            },

            methods: {
                async checkStatus() {
                    try {
                        const response = await fetch('/health');
                        const data = await response.json();
                        
                        if (data.status === 'ok' && data.privategpt_status) {
                            this.status = { online: true, message: '–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ PrivateGPT' };
                        } else {
                            this.status = { online: false, message: 'PrivateGPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω' };
                        }
                    } catch (error) {
                        this.status = { online: false, message: '–°–µ—Ä–≤–µ—Ä-–º–æ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω' };
                    }
                },

                setMode(mode) {
                    this.config.mode = mode;
                    
                    switch(mode) {
                        case 'basic':
                            // –í –±–∞–∑–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –æ—Ç–∫–ª—é—á–µ–Ω
                            this.config.useContext = false;
                            this.config.use_context = false;
                            this.showNotification('–ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º: –ß–∞—Ç –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', 'success');
                            break;
                        case 'search':
                            // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            this.config.useContext = this.config.useContext !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é true –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                            this.config.use_context = this.config.useContext;
                            this.showNotification('–†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞: –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö', 'success');
                            break;
                        case 'rag':
                            this.config.useContext = this.config.useContext !== false;
                            this.config.use_context = this.config.useContext;
                            this.showNotification('–†–µ–∂–∏–º RAG: –í–æ–ø—Ä–æ—Å—ã-–æ—Ç–≤–µ—Ç—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤', 'success');
                            break;
                        case 'summarize':
                            this.config.useContext = this.config.useContext !== false;
                            this.config.use_context = this.config.useContext;
                            this.showNotification('–†–µ–∂–∏–º —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞', 'success');
                            break;
                    }
                    
                    if (this.debugMode) {
                        console.log('üîÑ –†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞:', mode);
                        console.log('üîß useContext (UI):', this.config.useContext);
                        console.log('üîß use_context (API):', this.config.use_context);
                        console.log('üå°Ô∏è temperature:', this.config.temperature);
                        console.log('üéõÔ∏è maxTokens:', this.config.maxTokens);
                    }
                },

                async loadFiles() {
                    try {
                        const response = await fetch('/api/files');
                        if (response.ok) {
                            const data = await response.json();
                            this.files = data.data || [];
                            
                            if (this.debugMode) {
                                console.log('–§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', this.files.length, '—Ñ–∞–π–ª–æ–≤');
                                console.log('–î–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤:', data);
                            }
                            
                            const existingDocIds = this.files.map(f => f.doc_id);
                            this.config.selectedDocs = this.config.selectedDocs.filter(id => 
                                existingDocIds.includes(id)
                            );
                        } else {
                            const errorText = await response.text();
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:', response.status, errorText);
                            if (this.debugMode) {
                                this.showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ${errorText}`, 'error');
                            }
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:', error);
                        if (this.debugMode) {
                            this.showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ${error.message}`, 'error');
                        }
                    }
                },

                triggerFileInput() {
                    this.$refs.fileInput.click();
                },

                handleFileSelect(event) {
                    const files = Array.from(event.target.files);
                    if (files.length > 0) {
                        this.uploadFiles(files);
                    }
                },

                handleFileDrop(event) {
                    this.isDragOver = false;
                    const files = Array.from(event.dataTransfer.files);
                    if (files.length > 0) {
                        this.uploadFiles(files);
                    }
                },

                async uploadFiles(files) {
                    for (const file of files) {
                        if (file.size > 50 * 1024 * 1024) {
                            this.showNotification(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 50–ú–ë)`, 'error');
                            continue;
                        }

                        await this.uploadFile(file);
                    }
                },

                async uploadFile(file) {
                    this.uploading = true;
                    this.uploadProgress = 0;
                    this.lastUploadError = null;

                    try {
                        const formData = new FormData();
                        formData.append('file', file);

                        const fileSizeMB = file.size / (1024 * 1024);
                        const expectedMinutes = 2 + Math.floor(fileSizeMB / 2);
                        
                        if (fileSizeMB > 10) {
                            this.showNotification(`–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª (${fileSizeMB.toFixed(1)}–ú–ë). –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: ~${expectedMinutes} –º–∏–Ω—É—Ç`, 'success');
                        }

                        const progressInterval = setInterval(() => {
                            if (this.uploadProgress < 90) {
                                this.uploadProgress += Math.random() * 15;
                            }
                        }, 300);

                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        clearInterval(progressInterval);
                        this.uploadProgress = 100;

                        let result;
                        const contentType = response.headers.get('content-type');
                        
                        if (contentType && contentType.includes('application/json')) {
                            try {
                                result = await response.json();
                            } catch (parseError) {
                                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç–≤–µ—Ç–∞:', parseError);
                                result = { error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞' };
                            }
                        } else {
                            const text = await response.text();
                            result = { error: `–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: ${text}` };
                        }

                        if (this.debugMode) {
                            console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', response.status);
                            console.log('–û—Ç–≤–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏:', result);
                        }

                        if (response.status === 202 && result.processing) {
                            this.showNotification(`${result.message}`, 'success');
                            this.processingFiles.add(file.name);
                            this.startPeriodicFileCheck(file.name, expectedMinutes);
                            
                        } else if ((response.ok || response.status === 202) && result.success !== false) {
                            let message = result.message || `${file.name} –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!`;
                            
                            if (result.status === 'completed') {
                                message = `‚úÖ ${file.name} –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ!`;
                                this.processingFiles.delete(file.name);
                            } else if (result.status === 'processing') {
                                message = `‚è≥ ${file.name} –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è...`;
                                this.processingFiles.add(file.name);
                            }
                            
                            this.showNotification(message, 'success');
                            await this.loadFiles();
                            
                        } else {
                            let errorMessage = '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å';
                            
                            if (result.error) {
                                errorMessage = result.error;
                            } else if (result.details) {
                                errorMessage = result.details;
                            } else if (result.message) {
                                errorMessage = result.message;
                            } else {
                                errorMessage = `–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ${response.status}`;
                            }
                            
                            const errorInfo = {
                                status: response.status,
                                result: result,
                                file: file.name,
                                timestamp: new Date().toISOString()
                            };
                            
                            this.lastUploadError = JSON.stringify(errorInfo, null, 2);
                            
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', errorInfo);
                            this.showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${errorMessage}`, 'error');
                        }
                    } catch (error) {
                        const errorInfo = {
                            type: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏',
                            message: error.message,
                            file: file.name,
                            timestamp: new Date().toISOString()
                        };
                        
                        this.lastUploadError = JSON.stringify(errorInfo, null, 2);
                        
                        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                        this.showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
                    } finally {
                        this.uploading = false;
                        setTimeout(() => { this.uploadProgress = 0; }, 1000);
                    }
                },

                startPeriodicFileCheck(filename, maxMinutes) {
                    let checkCount = 0;
                    const maxChecks = maxMinutes * 2;
                    
                    const checkInterval = setInterval(async () => {
                        checkCount++;
                        
                        if (this.debugMode) {
                            console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ ${filename}, –ø–æ–ø—ã—Ç–∫–∞ ${checkCount}/${maxChecks}`);
                        }
                        
                        await this.loadFiles();
                        const fileExists = this.files.some(f => this.getFileName(f) === filename);
                        
                        if (fileExists) {
                            clearInterval(checkInterval);
                            this.processingFiles.delete(filename);
                            this.showNotification(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ ${filename} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ —Ñ–∞–π–ª —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω!`, 'success');
                            return;
                        }
                        
                        if (checkCount % 4 === 0) {
                            const remainingMinutes = Math.max(0, maxMinutes - Math.floor(checkCount / 2));
                            this.showNotification(`‚è≥ –í—Å–µ –µ—â–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è ${filename}... (–û—Å—Ç–∞–ª–æ—Å—å ~${remainingMinutes}–º–∏–Ω)`, 'success');
                        }
                        
                        if (checkCount >= maxChecks) {
                            clearInterval(checkInterval);
                            this.processingFiles.delete(filename);
                            this.showNotification(`‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ ${filename} –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤—Ä—É—á–Ω—É—é.`, 'error');
                        }
                    }, 30000);
                },

                selectAllFiles() {
                    this.config.selectedDocs = this.files.map(file => file.doc_id);
                    this.showNotification(`–í—ã–±—Ä–∞–Ω—ã –≤—Å–µ ${this.files.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤`, 'success');
                },

                clearSelectedFiles() {
                    this.config.selectedDocs = [];
                    this.showNotification('–í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—á–∏—â–µ–Ω', 'success');
                },

                async deleteAllFiles() {
                    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï ${this.files.length} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
                        return;
                    }

                    this.deletingAllFiles = true;
                    
                    try {
                        if (this.debugMode) {
                            console.log('–ù–∞—á–∏–Ω–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤...');
                        }

                        const response = await fetch('/api/files/delete-all', {
                            method: 'DELETE'
                        });

                        if (response.ok) {
                            let result;
                            try {
                                result = await response.json();
                            } catch (parseError) {
                                result = { 
                                    success: true, 
                                    message: '–í—Å–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ',
                                    deleted_count: this.files.length,
                                    failed_count: 0 
                                };
                            }
                            
                            if (this.debugMode) {
                                console.log('–û—Ç–≤–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö:', result);
                            }

                            if (result.success) {
                                let message = result.message || '–í—Å–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ';
                                
                                if (result.deleted_count !== undefined && result.failed_count !== undefined) {
                                    message = `–£–¥–∞–ª–µ–Ω–æ ${result.deleted_count} —Ñ–∞–π–ª–æ–≤`;
                                    if (result.failed_count > 0) {
                                        message += `, ${result.failed_count} –Ω–µ —É–¥–∞–ª–æ—Å—å`;
                                    }
                                }
                                
                                this.showNotification(message, result.failed_count > 0 ? 'error' : 'success');
                                
                                if (result.failed_files && result.failed_files.length > 0) {
                                    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã:', result.failed_files);
                                    setTimeout(() => {
                                        this.showNotification(`–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å: ${result.failed_files.join(', ')}`, 'error');
                                    }, 2000);
                                }
                            } else {
                                this.showNotification('–û–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏', 'error');
                            }
                            
                            await this.loadFiles();
                            this.config.selectedDocs = [];
                            
                        } else {
                            let errorMessage = `–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ${response.status}`;
                            try {
                                const result = await response.json();
                                errorMessage = result.error || result.message || errorMessage;
                            } catch (parseError) {
                                const text = await response.text();
                                errorMessage = text || errorMessage;
                            }
                            
                            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö:', errorMessage);
                            this.showNotification(`–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ —É–¥–∞–ª–æ—Å—å: ${errorMessage}`, 'error');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö:', error);
                        this.showNotification(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö: ${error.message}`, 'error');
                    } finally {
                        this.deletingAllFiles = false;
                    }
                },

                async deleteFile(docId) {
                    this.deletingFile = docId;
                    
                    try {
                        const response = await fetch(`/api/files/${docId}`, {
                            method: 'DELETE'
                        });

                        if (response.ok) {
                            let result;
                            try {
                                result = await response.json();
                            } catch (parseError) {
                                result = { message: '–§–∞–π–ª —É–¥–∞–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ' };
                            }
                            
                            this.showNotification(result.message || '–§–∞–π–ª —É–¥–∞–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                            await this.loadFiles();
                            
                            this.config.selectedDocs = this.config.selectedDocs.filter(id => id !== docId);
                            
                            if (this.debugMode) {
                                console.log('–§–∞–π–ª —É–¥–∞–ª–µ–Ω:', docId);
                            }
                        } else {
                            let errorMessage = `–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ${response.status}`;
                            try {
                                const result = await response.json();
                                errorMessage = result.error || result.message || errorMessage;
                            } catch (parseError) {
                                const text = await response.text();
                                errorMessage = text || errorMessage;
                            }
                            
                            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', errorMessage);
                            this.showNotification(`–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: ${errorMessage}`, 'error');
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                        this.showNotification(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
                    } finally {
                        this.deletingFile = null;
                    }
                },

                async sendMessage() {
                    if (!this.currentMessage.trim()) return;

                    const userMessage = {
                        id: this.messageId++,
                        role: 'user',
                        content: this.currentMessage.trim()
                    };

                    this.messages.push(userMessage);
                    const message = this.currentMessage.trim();
                    this.currentMessage = '';
                    this.isTyping = true;

                    this.scrollToBottom();

                    // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
                    const assistantMessage = {
                        id: this.messageId++,
                        role: 'assistant',
                        content: '',
                        streaming: true,
                        sources: []
                    };
                    this.messages.push(assistantMessage);

                    try {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º use_context –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∂–∏–º–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                        let effectiveUseContext = this.config.useContext;
                        
                        // –í basic —Ä–µ–∂–∏–º–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
                        if (this.config.mode === 'basic') {
                            effectiveUseContext = false;
                        }
                        
                        // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π payload
                        const payload = {
                            message: message,
                            config: {
                                mode: this.config.mode,
                                use_context: effectiveUseContext,
                                selected_docs: this.config.selectedDocs,
                                max_tokens: this.config.maxTokens,
                                temperature: this.config.temperature
                            },
                            system_prompt: this.systemPrompt,
                            history: this.messages.slice(0, -2) // –ò—Å–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—É—Å—Ç–æ–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞)
                        };

                        if (this.debugMode) {
                            console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º payload –¥–ª—è —Ä–µ–∂–∏–º–∞', this.config.mode);
                            console.log('üîß use_context:', payload.config.use_context, '(effective)');
                            console.log('üîß useContext (UI):', this.config.useContext);
                            console.log('üå°Ô∏è temperature:', payload.config.temperature, '(type:', typeof payload.config.temperature, ')');
                            console.log('üéõÔ∏è max_tokens:', payload.config.max_tokens, '(type:', typeof payload.config.max_tokens, ')');
                            console.log('üìã selected_docs:', payload.config.selected_docs);
                            console.log('üìù –ü–æ–ª–Ω—ã–π payload:', JSON.stringify(payload, null, 2));
                        }

                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const contentType = response.headers.get('content-type') || '';
                            
                            if (contentType.includes('text/event-stream')) {
                                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º SSE –ø–æ—Ç–æ–∫
                                await this.handleSSEStream(response, assistantMessage);
                            } else if (contentType.includes('application/json')) {
                                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º JSON –æ—Ç–≤–µ—Ç (fallback)
                                const data = await response.json();
                                await this.handleJSONResponse(data, assistantMessage);
                            } else {
                                // –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                                const text = await response.text();
                                assistantMessage.content = `–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞: ${contentType}\n\n${text}`;
                                assistantMessage.streaming = false;
                            }
                        } else {
                            const error = await response.text();
                            if (this.debugMode) {
                                console.error('‚ùå –û—à–∏–±–∫–∞ API:', error);
                            }
                            assistantMessage.content = `–û—à–∏–±–∫–∞: ${error}`;
                            assistantMessage.streaming = false;
                        }
                    } catch (error) {
                        if (this.debugMode) {
                            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                        }
                        assistantMessage.content = `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`;
                        assistantMessage.streaming = false;
                    } finally {
                        this.isTyping = false;
                        assistantMessage.streaming = false;
                        this.scrollToBottom();
                    }
                },

                async handleSSEStream(response, assistantMessage) {
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';
                    let fullContent = '';
                    let sources = new Set();

                    try {
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;

                            buffer += decoder.decode(value, { stream: true });
                            const lines = buffer.split('\n');
                            buffer = lines.pop() || '';

                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    const data = line.slice(6).trim();
                                    if (data === '[DONE]') {
                                        assistantMessage.streaming = false;
                                        return;
                                    }
                                    
                                    if (data) {
                                        try {
                                            const parsed = JSON.parse(data);
                                            
                                            if (this.debugMode) {
                                                console.log('üì¶ SSE chunk:', parsed);
                                            }

                                            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                                            if (parsed.choices && parsed.choices[0]) {
                                                const choice = parsed.choices[0];
                                                
                                                if (choice.delta && choice.delta.content) {
                                                    // Streaming format
                                                    fullContent += choice.delta.content;
                                                    assistantMessage.content = fullContent;
                                                } else if (choice.message && choice.message.content) {
                                                    // Complete message format
                                                    fullContent = choice.message.content;
                                                    assistantMessage.content = fullContent;
                                                } else if (choice.text) {
                                                    // Text format
                                                    fullContent += choice.text;
                                                    assistantMessage.content = fullContent;
                                                }

                                                // –°–æ–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏
                                                if (choice.sources) {
                                                    choice.sources.forEach(source => {
                                                        if (source.document?.doc_metadata?.file_name) {
                                                            sources.add(source.document.doc_metadata.file_name);
                                                        }
                                                    });
                                                }
                                            } else if (parsed.data && Array.isArray(parsed.data)) {
                                                // Search mode format
                                                const searchResults = parsed.data.map((chunk, index) => 
                                                    `**–†–µ–∑—É–ª—å—Ç–∞—Ç ${index + 1}:**\n${chunk.text}`
                                                ).join('\n\n');
                                                
                                                assistantMessage.content = searchResults;
                                                
                                                parsed.data.forEach(chunk => {
                                                    if (chunk.document?.doc_metadata?.file_name) {
                                                        sources.add(chunk.document.doc_metadata.file_name);
                                                    }
                                                });
                                            }

                                            this.scrollToBottom();
                                        } catch (parseError) {
                                            if (this.debugMode) {
                                                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å SSE –¥–∞–Ω–Ω—ã–µ:', data, parseError);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    } finally {
                        reader.releaseLock();
                        assistantMessage.sources = sources.size > 0 ? Array.from(sources) : null;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ —Ç–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ
                        if (this.debugMode && assistantMessage.content) {
                            assistantMessage.content += ` [${this.config.mode.toUpperCase()} | SSE stream]`;
                        }
                    }
                },

                async handleJSONResponse(data, assistantMessage) {
                    if (this.debugMode) {
                        console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω JSON –æ—Ç–≤–µ—Ç –¥–ª—è —Ä–µ–∂–∏–º–∞', this.config.mode);
                        console.log('üì® –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                    }
                    
                    let content = '';
                    let sources = [];

                    if (this.config.mode === 'search') {
                        if (data.data && data.data.length > 0) {
                            content = data.data.map((chunk, index) => 
                                `**–†–µ–∑—É–ª—å—Ç–∞—Ç ${index + 1}:**\n${chunk.text}`
                            ).join('\n\n');
                            sources = data.data.map(chunk => 
                                chunk.document?.doc_metadata?.file_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
                            ).filter(Boolean);
                        } else {
                            content = '–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö.';
                        }
                    } else {
                        if (data.choices && data.choices[0]) {
                            content = data.choices[0].message?.content || data.choices[0].text || '–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω';
                            
                            if (data.choices[0].sources) {
                                sources = data.choices[0].sources.map(source => 
                                    source.document?.doc_metadata?.file_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'
                                );
                            }
                        } else {
                            content = '–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω';
                        }
                    }

                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ —Ç–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ
                    const modeIndicator = this.debugMode ? ` [${this.config.mode.toUpperCase()} | JSON]` : '';

                    assistantMessage.content = content + modeIndicator;
                    assistantMessage.sources = sources.length > 0 ? [...new Set(sources)] : null;
                },

                async clearHistory() {
                    try {
                        const response = await fetch('/api/clear-history', {
                            method: 'POST'
                        });
                        
                        if (response.ok) {
                            this.messages = [];
                            this.showNotification('–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞!', 'success');
                        }
                    } catch (error) {
                        this.showNotification('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏', 'error');
                    }
                },

                scrollToBottom() {
                    this.$nextTick(() => {
                        const chatMessages = this.$refs.chatMessages;
                        if (chatMessages) {
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }
                    });
                },

                showNotification(message, type) {
                    this.notification = { show: true, message, type };
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                },

                autoResizeTextarea() {
                    this.$nextTick(() => {
                        const textarea = document.querySelector('.chat-input');
                        if (textarea) {
                            textarea.addEventListener('input', function() {
                                this.style.height = 'auto';
                                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                            });
                        }
                    });
                },

                async testChatAPI() {
                    try {
                        console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º Chat API...');
                        
                        const testPayload = {
                            message: "–ü—Ä–∏–≤–µ—Ç",
                            config: {
                                mode: 'basic',
                                use_context: false,
                                selected_docs: [],
                                max_tokens: 50,
                                temperature: 0.5
                            },
                            system_prompt: "",
                            history: []
                        };
                        
                        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π payload:', JSON.stringify(testPayload, null, 2));
                        
                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(testPayload)
                        });
                        
                        console.log('üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
                        console.log('üìã Headers –æ—Ç–≤–µ—Ç–∞:');
                        for (const [key, value] of response.headers.entries()) {
                            console.log(`  ${key}: ${value}`);
                        }
                        
                        const contentType = response.headers.get('content-type') || 'unknown';
                        console.log('üîç Content-Type:', contentType);
                        
                        if (response.ok) {
                            if (contentType.includes('text/event-stream')) {
                                console.log('üåä –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç SSE –ø–æ—Ç–æ–∫');
                                console.log('üìÑ –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ SSE —Å–æ–±—ã—Ç–∏–π...');
                                
                                const reader = response.body.getReader();
                                const decoder = new TextDecoder();
                                let buffer = '';
                                let eventCount = 0;
                                const maxEvents = 5;
                                
                                try {
                                    while (eventCount < maxEvents) {
                                        const { done, value } = await reader.read();
                                        if (done) break;
                                        
                                        buffer += decoder.decode(value, { stream: true });
                                        const lines = buffer.split('\n');
                                        buffer = lines.pop() || '';
                                        
                                        for (const line of lines) {
                                            if (line.startsWith('data: ')) {
                                                const data = line.slice(6).trim();
                                                if (data && data !== '[DONE]') {
                                                    try {
                                                        const parsed = JSON.parse(data);
                                                        console.log(`üì¶ SSE —Å–æ–±—ã—Ç–∏–µ ${++eventCount}:`, parsed);
                                                        
                                                        if (eventCount >= maxEvents) break;
                                                    } catch (e) {
                                                        console.log(`üìÑ –°—ã—Ä—ã–µ SSE –¥–∞–Ω–Ω—ã–µ ${++eventCount}:`, data.substring(0, 100));
                                                    }
                                                }
                                            }
                                        }
                                    }
                                } finally {
                                    reader.releaseLock();
                                }
                                
                                this.showNotification('‚úÖ SSE –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', 'success');
                                
                            } else if (contentType.includes('application/json')) {
                                try {
                                    const data = await response.json();
                                    console.log('‚úÖ JSON –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', data);
                                    this.showNotification('–¢–µ—Å—Ç Chat API —É—Å–ø–µ—à–µ–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', 'success');
                                } catch (jsonError) {
                                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:', jsonError);
                                    this.showNotification('Chat API –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON', 'error');
                                }
                            } else {
                                const text = await response.text();
                                console.log('üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç:', text.substring(0, 500));
                                this.showNotification(`Chat API –≤–µ—Ä–Ω—É–ª ${contentType} - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å`, 'error');
                            }
                        } else {
                            const errorText = await response.text();
                            console.error('‚ùå HTTP –æ—à–∏–±–∫–∞:', response.status, errorText);
                            this.showNotification(`Chat API –æ—à–∏–±–∫–∞ ${response.status} - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å`, 'error');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Chat API:', error);
                        this.showNotification(`–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                    }
                },

                async testConnection() {
                    try {
                        console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
                        
                        const healthResponse = await fetch('/health');
                        const healthData = await healthResponse.json();
                        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:', healthData);
                        
                        const filesResponse = await fetch('/api/files');
                        const filesData = await filesResponse.json();
                        console.log('API —Ñ–∞–π–ª–æ–≤:', filesData);
                        
                        const pgptResponse = await fetch('/v1/ingest/list');
                        const pgptData = await pgptResponse.json();
                        console.log('PrivateGPT –Ω–∞–ø—Ä—è–º—É—é:', pgptData);
                        
                        this.showNotification('–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å', 'success');
                    } catch (error) {
                        console.error('–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª—Å—è:', error);
                        this.showNotification(`–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª—Å—è: ${error.message}`, 'error');
                    }
                },

                debugSettings() {
                    console.log('üîç === –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò ===');
                    console.log('üéØ –†–µ–∂–∏–º:', this.config.mode);
                    console.log('üîß useContext (UI):', this.config.useContext);
                    console.log('üîß use_context (API):', this.config.use_context);
                    console.log('üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (config):', this.config.temperature, '(type:', typeof this.config.temperature, ')');
                    console.log('üéõÔ∏è –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ (config):', this.config.maxTokens, '(type:', typeof this.config.maxTokens, ')');
                    
                    const tempSlider = document.querySelector('input[type="range"]');
                    const tokensInput = document.querySelector('input[type="number"]');
                    const contextCheckbox = document.querySelector('input[type="checkbox"]');
                    
                    console.log('üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (HTML slider):', tempSlider ? tempSlider.value : 'not found', '(type:', typeof (tempSlider ? tempSlider.value : null), ')');
                    console.log('üéõÔ∏è –¢–æ–∫–µ–Ω—ã (HTML input):', tokensInput ? tokensInput.value : 'not found', '(type:', typeof (tokensInput ? tokensInput.value : null), ')');
                    console.log('üîß –ö–æ–Ω—Ç–µ–∫—Å—Ç (HTML checkbox):', contextCheckbox ? contextCheckbox.checked : 'not found');
                    
                    console.log('üìã –í—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:', this.config.selectedDocs);
                    console.log('üìù –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:', this.systemPrompt);
                    console.log('üêõ –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏:', this.debugMode);
                    console.log('üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:', this.files.length);
                    console.log('üí¨ –°–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏:', this.messages.length);
                    console.log('üîÑ === –ü–û–õ–ù–´–ô CONFIG ===');
                    console.log(JSON.stringify(this.config, null, 2));
                    
                    this.showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–≤–µ–¥–µ–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å (F12)', 'success');
                },

                getFileName(file) {
                    return file.doc_metadata?.file_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–∞–π–ª';
                },

                getFileType(file) {
                    const fileName = this.getFileName(file);
                    const ext = fileName.split('.').pop()?.toUpperCase();
                    return ext || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                },

                updateMaxTokens() {
                    if (this.debugMode) {
                        console.log('üéõÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω maxTokens:', this.config.maxTokens);
                    }
                },

                updateTemperature() {
                    if (this.debugMode) {
                        console.log('üå°Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:', this.config.temperature);
                    }
                },

                updateUseContext() {
                    this.config.use_context = this.config.useContext;
                    
                    if (this.debugMode) {
                        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω useContext:', this.config.useContext, 'use_context:', this.config.use_context);
                    }
                },

                formatContent(content) {
                    if (!content) return '';
                    
                    let formatted = content
                        .replace(/\n\n/g, '</p><p>')
                        .replace(/\n/g, '<br>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/`(.*?)`/g, '<code style="background: #f1f1f1; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>')
                        .replace(/^(\d+)\.\s+(.+)$/gm, '<div style="margin: 4px 0;"><strong>$1.</strong> $2</div>')
                        .replace(/^[-‚Ä¢]\s+(.+)$/gm, '<div style="margin: 2px 0 2px 20px;">‚Ä¢ $1</div>')
                        .replace(/^### (.+)$/gm, '<h4 style="margin: 10px 0 5px 0; color: #2563eb;">$1</h4>')
                        .replace(/^## (.+)$/gm, '<h3 style="margin: 12px 0 6px 0; color: #1e40af;">$1</h3>')
                        .replace(/^# (.+)$/gm, '<h2 style="margin: 15px 0 8px 0; color: #1e3a8a;">$1</h2>');
                    
                    if (formatted && !formatted.startsWith('<')) {
                        formatted = '<p>' + formatted + '</p>';
                    }
                    
                    return formatted;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
